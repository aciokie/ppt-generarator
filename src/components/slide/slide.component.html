 @if (slide() && theme()) {
  <div class="w-full h-full flex p-8 md:p-12" 
       [style.background-color]="theme().backgroundColor"
       [style.color]="theme().textColor"
       [style.font-family]="theme().bodyFont + ', sans-serif'">
    
    @switch (slide().layout) {
      @case ('title') {
        <div class="flex flex-col justify-center items-center text-center w-full">
          <div class="relative group">
            <h1 class="text-6xl font-bold rounded-md outline-none focus:ring-2 focus:ring-purple-500/80 focus:bg-white/5"
                [style.font-family]="theme().titleFont + ', serif'" 
                [style.color]="theme().primaryColor"
                contenteditable="true"
                (blur)="onContentChange('title', $event)"
                [textContent]="slide().title"></h1>
            <button (click)="triggerImproveContent('title')" title="Improve with AI" class="absolute -right-8 top-1/2 -translate-y-1/2 opacity-0 group-hover:opacity-100 transition-opacity text-purple-400 hover:text-purple-300 p-1 hover:scale-110">
              <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6"><path stroke-linecap="round" stroke-linejoin="round" d="M9.813 15.904 9 18.75l-.813-2.846a4.5 4.5 0 0 0-3.09-3.09L2.25 12l2.846-.813a4.5 4.5 0 0 0 3.09-3.09L9 5.25l.813 2.846a4.5 4.5 0 0 0 3.09 3.09L15.75 12l-2.846.813a4.5 4.5 0 0 0-3.09 3.09ZM18.259 8.715 18 9.75l-.259-1.035a3.375 3.375 0 0 0-2.455-2.456L14.25 6l1.036-.259a3.375 3.375 0 0 0 2.455-2.456L18 2.25l.259 1.035a3.375 3.375 0 0 0 2.456 2.456L21.75 6l-1.035.259a3.375 3.375 0 0 0-2.456 2.456Z" /></svg>
            </button>
          </div>
          @if(normalizedContent()[0]) {
            <div class="relative group mt-4">
              <p class="text-2xl rounded-md outline-none focus:ring-2 focus:ring-purple-500/80 focus:bg-white/5"
                 contenteditable="true"
                 (blur)="onContentChange('content', $event, 0)"
                 [textContent]="normalizedContent()[0]"></p>
               <button (click)="triggerImproveContent('content', 0)" title="Improve with AI" class="absolute -right-8 top-1/2 -translate-y-1/2 opacity-0 group-hover:opacity-100 transition-opacity text-purple-400 hover:text-purple-300 p-1 hover:scale-110">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5"><path stroke-linecap="round" stroke-linejoin="round" d="M9.813 15.904 9 18.75l-.813-2.846a4.5 4.5 0 0 0-3.09-3.09L2.25 12l2.846-.813a4.5 4.5 0 0 0 3.09-3.09L9 5.25l.813 2.846a4.5 4.5 0 0 0 3.09 3.09L15.75 12l-2.846.813a4.5 4.5 0 0 0-3.09 3.09ZM18.259 8.715 18 9.75l-.259-1.035a3.375 3.375 0 0 0-2.455-2.456L14.25 6l1.036-.259a3.375 3.375 0 0 0 2.455-2.456L18 2.25l.259 1.035a3.375 3.375 0 0 0 2.456 2.456L21.75 6l-1.035.259a3.375 3.375 0 0 0-2.456 2.456Z" /></svg>
              </button>
            </div>
          }
        </div>
      }
      @case ('section_header') {
        <div class="flex flex-col justify-center w-full relative group p-8 rounded-lg" [style.background]="'linear-gradient(90deg, ' + theme().primaryColor + '10, transparent)'">
          <h2 class="text-5xl font-bold border-l-8 pl-4 rounded-md outline-none focus:ring-2 focus:ring-purple-500/80 focus:bg-white/5"
              [style.font-family]="theme().titleFont + ', serif'" 
              [style.border-color]="theme().primaryColor"
              contenteditable="true"
              (blur)="onContentChange('title', $event)"
              [textContent]="slide().title"></h2>
           <button (click)="triggerImproveContent('title')" title="Improve with AI" class="absolute right-4 top-1/2 -translate-y-1/2 opacity-0 group-hover:opacity-100 transition-opacity text-purple-400 hover:text-purple-300 p-1 hover:scale-110">
             <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6"><path stroke-linecap="round" stroke-linejoin="round" d="M9.813 15.904 9 18.75l-.813-2.846a4.5 4.5 0 0 0-3.09-3.09L2.25 12l2.846-.813a4.5 4.5 0 0 0 3.09-3.09L9 5.25l.813 2.846a4.5 4.5 0 0 0 3.09 3.09L15.75 12l-2.846.813a4.5 4.5 0 0 0-3.09 3.09ZM18.259 8.715 18 9.75l-.259-1.035a3.375 3.375 0 0 0-2.455-2.456L14.25 6l1.036-.259a3.375 3.375 0 0 0 2.455-2.456L18 2.25l.259 1.035a3.375 3.375 0 0 0 2.456 2.456L21.75 6l-1.035.259a3.375 3.375 0 0 0-2.456 2.456Z" /></svg>
          </button>
        </div>
      }
      @case ('conclusion') {
        <div class="flex flex-col justify-center items-center text-center w-full">
          <div class="relative group">
            <h1 class="text-6xl font-bold rounded-md outline-none focus:ring-2 focus:ring-purple-500/80 focus:bg-white/5"
                [style.font-family]="theme().titleFont + ', serif'" 
                [style.color]="theme().primaryColor"
                contenteditable="true"
                (blur)="onContentChange('title', $event)"
                [textContent]="slide().title"></h1>
            <button (click)="triggerImproveContent('title')" title="Improve with AI" class="absolute -right-8 top-1/2 -translate-y-1/2 opacity-0 group-hover:opacity-100 transition-opacity text-purple-400 hover:text-purple-300 p-1 hover:scale-110">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6"><path stroke-linecap="round" stroke-linejoin="round" d="M9.813 15.904 9 18.75l-.813-2.846a4.5 4.5 0 0 0-3.09-3.09L2.25 12l2.846-.813a4.5 4.5 0 0 0 3.09-3.09L9 5.25l.813 2.846a4.5 4.5 0 0 0 3.09 3.09L15.75 12l-2.846.813a4.5 4.5 0 0 0-3.09 3.09ZM18.259 8.715 18 9.75l-.259-1.035a3.375 3.375 0 0 0-2.455-2.456L14.25 6l1.036-.259a3.375 3.375 0 0 0 2.455-2.456L18 2.25l.259 1.035a3.375 3.375 0 0 0 2.456 2.456L21.75 6l-1.035.259a3.375 3.375 0 0 0-2.456 2.456Z" /></svg>
            </button>
          </div>
          <div class="relative group mt-4">
            <p class="text-2xl rounded-md outline-none focus:ring-2 focus:ring-purple-500/80 focus:bg-white/5"
               contenteditable="true"
               (blur)="onContentChange('content', $event, 0)"
               [textContent]="normalizedContent()[0]"></p>
            <button (click)="triggerImproveContent('content', 0)" title="Improve with AI" class="absolute -right-8 top-1/2 -translate-y-1/2 opacity-0 group-hover:opacity-100 transition-opacity text-purple-400 hover:text-purple-300 p-1 hover:scale-110">
              <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5"><path stroke-linecap="round" stroke-linejoin="round" d="M9.813 15.904 9 18.75l-.813-2.846a4.5 4.5 0 0 0-3.09-3.09L2.25 12l2.846-.813a4.5 4.5 0 0 0 3.09-3.09L9 5.25l.813 2.846a4.5 4.5 0 0 0 3.09 3.09L15.75 12l-2.846.813a4.5 4.5 0 0 0-3.09 3.09ZM18.259 8.715 18 9.75l-.259-1.035a3.375 3.375 0 0 0-2.455-2.456L14.25 6l1.036-.259a3.375 3.375 0 0 0 2.455-2.456L18 2.25l.259 1.035a3.375 3.375 0 0 0 2.456 2.456L21.75 6l-1.035.259a3.375 3.375 0 0 0-2.456 2.456Z" /></svg>
            </button>
          </div>
        </div>
      }
      @case ('content_left') {
        <div class="flex w-full items-center gap-8">
          <div class="w-1/2">
            <div class="relative group mb-4">
              <h2 class="text-4xl font-bold rounded-md outline-none focus:ring-2 focus:ring-purple-500/80 focus:bg-white/5"
                  [style.font-family]="theme().titleFont + ', serif'"
                  [style.color]="theme().primaryColor"
                  contenteditable="true"
                  (blur)="onContentChange('title', $event)"
                  [textContent]="slide().title"></h2>
              <button (click)="triggerImproveContent('title')" title="Improve with AI" class="absolute -right-8 top-1/2 -translate-y-1/2 opacity-0 group-hover:opacity-100 transition-opacity text-purple-400 hover:text-purple-300 p-1 hover:scale-110">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6"><path stroke-linecap="round" stroke-linejoin="round" d="M9.813 15.904 9 18.75l-.813-2.846a4.5 4.5 0 0 0-3.09-3.09L2.25 12l2.846-.813a4.5 4.5 0 0 0 3.09-3.09L9 5.25l.813 2.846a4.5 4.5 0 0 0 3.09 3.09L15.75 12l-2.846.813a4.5 4.5 0 0 0-3.09 3.09ZM18.259 8.715 18 9.75l-.259-1.035a3.375 3.375 0 0 0-2.455-2.456L14.25 6l1.036-.259a3.375 3.375 0 0 0 2.455-2.456L18 2.25l.259 1.035a3.375 3.375 0 0 0 2.456 2.456L21.75 6l-1.035.259a3.375 3.375 0 0 0-2.456 2.456Z" /></svg>
              </button>
            </div>
            <ul class="list-disc pl-5 space-y-2 text-xl">
              @for(item of normalizedContent(); track i; let i = $index) {
                <li class="relative group break-words">
                  <span contenteditable="true" (blur)="onContentChange('content', $event, i)" [textContent]="item" class="rounded-md outline-none focus:ring-2 focus:ring-purple-500/80 focus:bg-white/5"></span>
                  <button (click)="triggerImproveContent('content', i)" title="Improve with AI" class="absolute -right-6 top-1/2 -translate-y-1/2 opacity-0 group-hover:opacity-100 transition-opacity text-purple-400 hover:text-purple-300 p-1 hover:scale-110">
                   <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-4 h-4"><path stroke-linecap="round" stroke-linejoin="round" d="M9.813 15.904 9 18.75l-.813-2.846a4.5 4.5 0 0 0-3.09-3.09L2.25 12l2.846-.813a4.5 4.5 0 0 0 3.09-3.09L9 5.25l.813 2.846a4.5 4.5 0 0 0 3.09 3.09L15.75 12l-2.846.813a4.5 4.5 0 0 0-3.09 3.09ZM18.259 8.715 18 9.75l-.259-1.035a3.375 3.375 0 0 0-2.455-2.456L14.25 6l1.036-.259a3.375 3.375 0 0 0 2.455-2.456L18 2.25l.259 1.035a3.375 3.375 0 0 0 2.456 2.456L21.75 6l-1.035.259a3.375 3.375 0 0 0-2.456 2.456Z" /></svg>
                  </button>
                </li>
              }
            </ul>
          </div>
          <div class="w-1/2 h-full">
            <ng-container [ngTemplateOutlet]="imagePlaceholder"></ng-container>
          </div>
        </div>
      }
      @case ('content_right') {
        <div class="flex w-full items-center gap-8">
          <div class="w-1/2 h-full">
            <ng-container [ngTemplateOutlet]="imagePlaceholder"></ng-container>
          </div>
          <div class="w-1/2">
            <div class="relative group mb-4">
              <h2 class="text-4xl font-bold rounded-md outline-none focus:ring-2 focus:ring-purple-500/80 focus:bg-white/5"
                  [style.font-family]="theme().titleFont + ', serif'"
                  [style.color]="theme().primaryColor"
                  contenteditable="true"
                  (blur)="onContentChange('title', $event)"
                  [textContent]="slide().title"></h2>
              <button (click)="triggerImproveContent('title')" title="Improve with AI" class="absolute -right-8 top-1/2 -translate-y-1/2 opacity-0 group-hover:opacity-100 transition-opacity text-purple-400 hover:text-purple-300 p-1 hover:scale-110">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6"><path stroke-linecap="round" stroke-linejoin="round" d="M9.813 15.904 9 18.75l-.813-2.846a4.5 4.5 0 0 0-3.09-3.09L2.25 12l2.846-.813a4.5 4.5 0 0 0 3.09-3.09L9 5.25l.813 2.846a4.5 4.5 0 0 0 3.09 3.09L15.75 12l-2.846.813a4.5 4.5 0 0 0-3.09 3.09ZM18.259 8.715 18 9.75l-.259-1.035a3.375 3.375 0 0 0-2.455-2.456L14.25 6l1.036-.259a3.375 3.375 0 0 0 2.455-2.456L18 2.25l.259 1.035a3.375 3.375 0 0 0 2.456 2.456L21.75 6l-1.035.259a3.375 3.375 0 0 0-2.456 2.456Z" /></svg>
              </button>
            </div>
            <ul class="list-disc pl-5 space-y-2 text-xl">
              @for(item of normalizedContent(); track i; let i = $index) {
                <li class="relative group break-words">
                   <span contenteditable="true" (blur)="onContentChange('content', $event, i)" [textContent]="item" class="rounded-md outline-none focus:ring-2 focus:ring-purple-500/80 focus:bg-white/5"></span>
                   <button (click)="triggerImproveContent('content', i)" title="Improve with AI" class="absolute -right-6 top-1/2 -translate-y-1/2 opacity-0 group-hover:opacity-100 transition-opacity text-purple-400 hover:text-purple-300 p-1 hover:scale-110">
                     <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-4 h-4"><path stroke-linecap="round" stroke-linejoin="round" d="M9.813 15.904 9 18.75l-.813-2.846a4.5 4.5 0 0 0-3.09-3.09L2.25 12l2.846-.813a4.5 4.5 0 0 0 3.09-3.09L9 5.25l.813 2.846a4.5 4.5 0 0 0 3.09 3.09L15.75 12l-2.846.813a4.5 4.5 0 0 0-3.09 3.09ZM18.259 8.715 18 9.75l-.259-1.035a3.375 3.375 0 0 0-2.455-2.456L14.25 6l1.036-.259a3.375 3.375 0 0 0 2.455-2.456L18 2.25l.259 1.035a3.375 3.375 0 0 0 2.456 2.456L21.75 6l-1.035.259a3.375 3.375 0 0 0-2.456 2.456Z" /></svg>
                  </button>
                </li>
              }
            </ul>
          </div>
        </div>
      }
      @case ('two_column') {
        <div class="flex flex-col w-full">
            <div class="relative group mb-6 text-center">
              <h2 class="text-4xl font-bold rounded-md outline-none focus:ring-2 focus:ring-purple-500/80 focus:bg-white/5"
                    [style.font-family]="theme().titleFont + ', serif'"
                    [style.color]="theme().primaryColor"
                    contenteditable="true"
                    (blur)="onContentChange('title', $event)"
                    [textContent]="slide().title"></h2>
              <button (click)="triggerImproveContent('title')" title="Improve with AI" class="absolute -right-0 top-1/2 -translate-y-1/2 opacity-0 group-hover:opacity-100 transition-opacity text-purple-400 hover:text-purple-300 p-1 hover:scale-110">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6"><path stroke-linecap="round" stroke-linejoin="round" d="M9.813 15.904 9 18.75l-.813-2.846a4.5 4.5 0 0 0-3.09-3.09L2.25 12l2.846-.813a4.5 4.5 0 0 0 3.09-3.09L9 5.25l.813 2.846a4.5 4.5 0 0 0 3.09 3.09L15.75 12l-2.846.813a4.5 4.5 0 0 0-3.09 3.09ZM18.259 8.715 18 9.75l-.259-1.035a3.375 3.375 0 0 0-2.455-2.456L14.25 6l1.036-.259a3.375 3.375 0 0 0 2.455-2.456L18 2.25l.259 1.035a3.375 3.375 0 0 0 2.456 2.456L21.75 6l-1.035.259a3.375 3.375 0 0 0-2.456 2.456Z" /></svg>
              </button>
            </div>
            <div class="flex-grow flex gap-8">
              <div class="w-1/2">
                <ul class="list-disc pl-5 space-y-2" [class.text-xl]="!slide().isSourceSlide" [class.text-base]="slide().isSourceSlide">
                  @for(item of normalizedContent().slice(0, contentMidpoint()); track i; let i = $index) {
                    <li class="relative group break-words" [class.break-all]="slide().isSourceSlide">
                      <span contenteditable="true" (blur)="onContentChange('content', $event, i)" [textContent]="item" class="rounded-md outline-none focus:ring-2 focus:ring-purple-500/80 focus:bg-white/5"></span>
                      <button (click)="triggerImproveContent('content', i)" title="Improve with AI" class="absolute -right-6 top-1/2 -translate-y-1/2 opacity-0 group-hover:opacity-100 transition-opacity text-purple-400 hover:text-purple-300 p-1 hover:scale-110">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-4 h-4"><path stroke-linecap="round" stroke-linejoin="round" d="M9.813 15.904 9 18.75l-.813-2.846a4.5 4.5 0 0 0-3.09-3.09L2.25 12l2.846-.813a4.5 4.5 0 0 0 3.09-3.09L9 5.25l.813 2.846a4.5 4.5 0 0 0 3.09 3.09L15.75 12l-2.846.813a4.5 4.5 0 0 0-3.09 3.09ZM18.259 8.715 18 9.75l-.259-1.035a3.375 3.375 0 0 0-2.455-2.456L14.25 6l1.036-.259a3.375 3.375 0 0 0 2.455-2.456L18 2.25l.259 1.035a3.375 3.375 0 0 0 2.456 2.456L21.75 6l-1.035.259a3.375 3.375 0 0 0-2.456 2.456Z" /></svg>
                      </button>
                    </li>
                  }
                </ul>
              </div>
              <div class="w-1/2">
                 <ul class="list-disc pl-5 space-y-2" [class.text-xl]="!slide().isSourceSlide" [class.text-base]="slide().isSourceSlide">
                  @for(item of normalizedContent().slice(contentMidpoint()); track i; let i = $index) {
                    <li class="relative group break-words" [class.break-all]="slide().isSourceSlide">
                      <span contenteditable="true" (blur)="onContentChange('content', $event, i + contentMidpoint())" [textContent]="item" class="rounded-md outline-none focus:ring-2 focus:ring-purple-500/80 focus:bg-white/5"></span>
                      <button (click)="triggerImproveContent('content', i + contentMidpoint())" title="Improve with AI" class="absolute -right-6 top-1/2 -translate-y-1/2 opacity-0 group-hover:opacity-100 transition-opacity text-purple-400 hover:text-purple-300 p-1 hover:scale-110">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-4 h-4"><path stroke-linecap="round" stroke-linejoin="round" d="M9.813 15.904 9 18.75l-.813-2.846a4.5 4.5 0 0 0-3.09-3.09L2.25 12l2.846-.813a4.5 4.5 0 0 0 3.09-3.09L9 5.25l.813 2.846a4.5 4.5 0 0 0 3.09 3.09L15.75 12l-2.846.813a4.5 4.5 0 0 0-3.09 3.09ZM18.259 8.715 18 9.75l-.259-1.035a3.375 3.375 0 0 0-2.455-2.456L14.25 6l1.036-.259a3.375 3.375 0 0 0 2.455-2.456L18 2.25l.259 1.035a3.375 3.375 0 0 0 2.456 2.456L21.75 6l-1.035.259a3.375 3.375 0 0 0-2.456 2.456Z" /></svg>
                      </button>
                    </li>
                  }
                </ul>
              </div>
            </div>
        </div>
      }
      @case ('three_column') {
        <div class="flex flex-col w-full">
            <div class="relative group mb-6 text-center">
              <h2 class="text-4xl font-bold rounded-md outline-none focus:ring-2 focus:ring-purple-500/80 focus:bg-white/5"
                    [style.font-family]="theme().titleFont + ', serif'"
                    [style.color]="theme().primaryColor"
                    contenteditable="true"
                    (blur)="onContentChange('title', $event)"
                    [textContent]="slide().title"></h2>
              <button (click)="triggerImproveContent('title')" title="Improve with AI" class="absolute -right-0 top-1/2 -translate-y-1/2 opacity-0 group-hover:opacity-100 transition-opacity text-purple-400 hover:text-purple-300 p-1 hover:scale-110">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6"><path stroke-linecap="round" stroke-linejoin="round" d="M9.813 15.904 9 18.75l-.813-2.846a4.5 4.5 0 0 0-3.09-3.09L2.25 12l2.846-.813a4.5 4.5 0 0 0 3.09-3.09L9 5.25l.813 2.846a4.5 4.5 0 0 0 3.09 3.09L15.75 12l-2.846.813a4.5 4.5 0 0 0-3.09 3.09ZM18.259 8.715 18 9.75l-.259-1.035a3.375 3.375 0 0 0-2.455-2.456L14.25 6l1.036-.259a3.375 3.375 0 0 0 2.455-2.456L18 2.25l.259 1.035a3.375 3.375 0 0 0 2.456 2.456L21.75 6l-1.035.259a3.375 3.375 0 0 0-2.456 2.456Z" /></svg>
              </button>
            </div>
            <div class="flex-grow flex justify-center gap-8">
              @for(column of threeColumnContent(); track i; let i = $index) {
                <div class="w-1/3 p-4 border border-gray-700/50 rounded-lg">
                  <div class="flex items-center justify-center mb-4">
                    <div class="w-10 h-10 rounded-full flex items-center justify-center font-bold text-xl"
                         [style.background-color]="theme().primaryColor"
                         [style.color]="theme().backgroundColor">
                      {{ i + 1 }}
                    </div>
                  </div>
                  <div class="relative group">
                    <h3 class="text-xl font-bold text-center mb-2 rounded-md outline-none focus:ring-2 focus:ring-purple-500/80 focus:bg-white/5"
                        [style.font-family]="theme().titleFont + ', serif'"
                        contenteditable="true"
                        (blur)="onContentChange('column_title', $event, i)"
                        [textContent]="column.title"></h3>
                     <button (click)="triggerImproveContent('column_title', i)" title="Improve with AI" class="absolute -right-4 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-purple-400 hover:text-purple-300 p-1 hover:scale-110">
                       <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-4 h-4"><path stroke-linecap="round" stroke-linejoin="round" d="M9.813 15.904 9 18.75l-.813-2.846a4.5 4.5 0 0 0-3.09-3.09L2.25 12l2.846-.813a4.5 4.5 0 0 0 3.09-3.09L9 5.25l.813 2.846a4.5 4.5 0 0 0 3.09 3.09L15.75 12l-2.846.813a4.5 4.5 0 0 0-3.09 3.09ZM18.259 8.715 18 9.75l-.259-1.035a3.375 3.375 0 0 0-2.455-2.456L14.25 6l1.036-.259a3.375 3.375 0 0 0 2.455-2.456L18 2.25l.259 1.035a3.375 3.375 0 0 0 2.456 2.456L21.75 6l-1.035.259a3.375 3.375 0 0 0-2.456 2.456Z" /></svg>
                    </button>
                  </div>
                   <div class="relative group">
                    <p class="text-base text-center rounded-md outline-none focus:ring-2 focus:ring-purple-500/80 focus:bg-white/5"
                        contenteditable="true"
                        (blur)="onContentChange('column_text', $event, i)"
                        [textContent]="column.text"></p>
                    <button (click)="triggerImproveContent('column_text', i)" title="Improve with AI" class="absolute -right-4 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-purple-400 hover:text-purple-300 p-1 hover:scale-110">
                      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-4 h-4"><path stroke-linecap="round" stroke-linejoin="round" d="M9.813 15.904 9 18.75l-.813-2.846a4.5 4.5 0 0 0-3.09-3.09L2.25 12l2.846-.813a4.5 4.5 0 0 0 3.09-3.09L9 5.25l.813 2.846a4.5 4.5 0 0 0 3.09 3.09L15.75 12l-2.846.813a4.5 4.5 0 0 0-3.09 3.09ZM18.259 8.715 18 9.75l-.259-1.035a3.375 3.375 0 0 0-2.455-2.456L14.25 6l1.036-.259a3.375 3.375 0 0 0 2.455-2.456L18 2.25l.259 1.035a3.375 3.375 0 0 0 2.456 2.456L21.75 6l-1.035.259a3.375 3.375 0 0 0-2.456 2.456Z" /></svg>
                    </button>
                  </div>
                </div>
              }
            </div>
        </div>
      }
      @case ('quote') {
        <div class="flex flex-col justify-center items-center text-center w-full px-16">
          <div class="relative group mb-8">
            <h2 class="text-4xl font-bold rounded-md outline-none focus:ring-2 focus:ring-purple-500/80 focus:bg-white/5"
                [style.font-family]="theme().titleFont + ', serif'"
                [style.color]="theme().primaryColor"
                contenteditable="true"
                (blur)="onContentChange('title', $event)"
                [textContent]="slide().title"></h2>
            <button (click)="triggerImproveContent('title')" title="Improve with AI" class="absolute -right-8 top-1/2 -translate-y-1/2 opacity-0 group-hover:opacity-100 transition-opacity text-purple-400 hover:text-purple-300 p-1 hover:scale-110">
              <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6"><path stroke-linecap="round" stroke-linejoin="round" d="M9.813 15.904 9 18.75l-.813-2.846a4.5 4.5 0 0 0-3.09-3.09L2.25 12l2.846-.813a4.5 4.5 0 0 0 3.09-3.09L9 5.25l.813 2.846a4.5 4.5 0 0 0 3.09 3.09L15.75 12l-2.846.813a4.5 4.5 0 0 0-3.09 3.09ZM18.259 8.715 18 9.75l-.259-1.035a3.375 3.375 0 0 0-2.455-2.456L14.25 6l1.036-.259a3.375 3.375 0 0 0 2.455-2.456L18 2.25l.259 1.035a3.375 3.375 0 0 0 2.456 2.456L21.75 6l-1.035.259a3.375 3.375 0 0 0-2.456 2.456Z" /></svg>
            </button>
          </div>
          @if(normalizedContent()[0]) {
            <blockquote class="text-4xl italic relative group p-8" 
                  [style.font-family]="theme().bodyFont + ', serif'" 
                  [style.color]="theme().textColor">
              <span class="absolute top-0 left-0 text-9xl opacity-10 pointer-events-none" [style.color]="theme().primaryColor">&ldquo;</span>
              <span class="leading-relaxed relative z-10 rounded-md outline-none focus:ring-2 focus:ring-purple-500/80 focus:bg-white/5"
                    contenteditable="true"
                    (blur)="onContentChange('content', $event, 0)"
                    [textContent]="normalizedContent()[0]"></span>
              <button (click)="triggerImproveContent('content', 0)" title="Improve with AI" class="absolute -right-8 top-1/2 -translate-y-1/2 opacity-0 group-hover:opacity-100 transition-opacity text-purple-400 hover:text-purple-300 p-1 hover:scale-110">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5"><path stroke-linecap="round" stroke-linejoin="round" d="M9.813 15.904 9 18.75l-.813-2.846a4.5 4.5 0 0 0-3.09-3.09L2.25 12l2.846-.813a4.5 4.5 0 0 0 3.09-3.09L9 5.25l.813 2.846a4.5 4.5 0 0 0 3.09 3.09L15.75 12l-2.846.813a4.5 4.5 0 0 0-3.09 3.09ZM18.259 8.715 18 9.75l-.259-1.035a3.375 3.375 0 0 0-2.455-2.456L14.25 6l1.036-.259a3.375 3.375 0 0 0 2.455-2.456L18 2.25l.259 1.035a3.375 3.375 0 0 0 2.456 2.456L21.75 6l-1.035.259a3.375 3.375 0 0 0-2.456 2.456Z" /></svg>
              </button>
            </blockquote>
          }
          @if(normalizedContent()[1]) {
            <cite class="block text-xl mt-6 not-italic relative group" 
                  [style.font-family]="theme().bodyFont + ', sans-serif'">
              â€” <span contenteditable="true"
                       (blur)="onContentChange('content', $event, 1)"
                       [textContent]="normalizedContent()[1]" class="rounded-md outline-none focus:ring-2 focus:ring-purple-500/80 focus:bg-white/5"></span>
              <button (click)="triggerImproveContent('content', 1)" title="Improve with AI" class="absolute -right-8 top-1/2 -translate-y-1/2 opacity-0 group-hover:opacity-100 transition-opacity text-purple-400 hover:text-purple-300 p-1 hover:scale-110">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5"><path stroke-linecap="round" stroke-linejoin="round" d="M9.813 15.904 9 18.75l-.813-2.846a4.5 4.5 0 0 0-3.09-3.09L2.25 12l2.846-.813a4.5 4.5 0 0 0 3.09-3.09L9 5.25l.813 2.846a4.5 4.5 0 0 0 3.09 3.09L15.75 12l-2.846.813a4.5 4.5 0 0 0-3.09 3.09ZM18.259 8.715 18 9.75l-.259-1.035a3.375 3.375 0 0 0-2.455-2.456L14.25 6l1.036-.259a3.375 3.375 0 0 0 2.455-2.456L18 2.25l.259 1.035a3.375 3.375 0 0 0 2.456 2.456L21.75 6l-1.035.259a3.375 3.375 0 0 0-2.456 2.456Z" /></svg>
              </button>
            </cite>
          }
        </div>
      }
      @case ('image_full_bleed') {
        <div class="w-full h-full relative flex flex-col justify-center items-center text-center -m-8 md:-m-12 group">
          @if (slide().imageUrl) {
            <div class="absolute inset-0 w-full h-full overflow-hidden z-0">
                <img [src]="slide().imageUrl" alt="{{ slide().imagePrompt }}" class="absolute inset-0 w-full h-full object-cover animate-kenburns">
            </div>
            <div class="absolute inset-0 w-full h-full bg-black/50 z-10"></div>
          }
          
          @if(slide().imageUrl) {
            <!-- AI Action Buttons for Media -->
            <div class="absolute top-4 right-4 z-30 flex flex-col gap-2 opacity-0 group-hover:opacity-100 transition-opacity">
                <button (click)="editImage.emit()" title="Edit Image with AI" class="p-2 bg-gray-800/70 text-white rounded-full hover:bg-purple-600">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path d="M13.586 3.586a2 2 0 112.828 2.828l-.793.793-2.828-2.828.793-.793zM11.379 5.793L3 14.172V17h2.828l8.38-8.379-2.83-2.828z" /></svg>
                </button>
                <button (click)="generateContentFromImage.emit()" title="Generate Content from Image" class="p-2 bg-gray-800/70 text-white rounded-full hover:bg-purple-600">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M4 4a2 2 0 00-2 2v4a2 2 0 002 2h4v4a2 2 0 002 2h4a2 2 0 002-2v-4a2 2 0 00-2-2h-4V6a2 2 0 00-2-2H4zm2 6a2 2 0 100-4 2 2 0 000 4zm8-2a2 2 0 11-4 0 2 2 0 014 0z" clip-rule="evenodd" /></svg>
                </button>
                <button (click)="removeImage.emit()" title="Remove Image" class="p-2 bg-gray-800/70 text-white rounded-full hover:bg-red-600">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z" clip-rule="evenodd" /></svg>
                </button>
            </div>

            <div class="relative z-20 px-4">
              <div class="relative group">
                <h1 class="text-6xl font-bold text-white rounded-md outline-none focus:ring-2 focus:ring-purple-500/80 focus:bg-black/20"
                    [style.font-family]="theme().titleFont + ', serif'" 
                    style="text-shadow: 2px 2px 8px rgba(0,0,0,0.7);"
                    contenteditable="true"
                    (blur)="onContentChange('title', $event)"
                    [textContent]="slide().title"></h1>
                <button (click)="triggerImproveContent('title')" title="Improve with AI" class="absolute -right-8 top-1/2 -translate-y-1/2 opacity-0 group-hover:opacity-100 transition-opacity text-purple-300 hover:text-white p-1 hover:scale-110">
                  <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6"><path stroke-linecap="round" stroke-linejoin="round" d="M9.813 15.904 9 18.75l-.813-2.846a4.5 4.5 0 0 0-3.09-3.09L2.25 12l2.846-.813a4.5 4.5 0 0 0 3.09-3.09L9 5.25l.813 2.846a4.5 4.5 0 0 0 3.09 3.09L15.75 12l-2.846.813a4.5 4.5 0 0 0-3.09 3.09ZM18.259 8.715 18 9.75l-.259-1.035a3.375 3.375 0 0 0-2.455-2.456L14.25 6l1.036-.259a3.375 3.375 0 0 0 2.455-2.456L18 2.25l.259 1.035a3.375 3.375 0 0 0 2.456 2.456L21.75 6l-1.035.259a3.375 3.375 0 0 0-2.456 2.456Z" /></svg>
                </button>
              </div>
              @if(normalizedContent()[0]) {
                <div class="relative group mt-4">
                  <p class="text-2xl text-white rounded-md outline-none focus:ring-2 focus:ring-purple-500/80 focus:bg-black/20"
                    style="text-shadow: 1px 1px 6px rgba(0,0,0,0.7);"
                    contenteditable="true"
                    (blur)="onContentChange('content', $event, 0)"
                    [textContent]="normalizedContent()[0]"></p>
                  <button (click)="triggerImproveContent('content', 0)" title="Improve with AI" class="absolute -right-8 top-1/2 -translate-y-1/2 opacity-0 group-hover:opacity-100 transition-opacity text-purple-300 hover:text-white p-1 hover:scale-110">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5"><path stroke-linecap="round" stroke-linejoin="round" d="M9.813 15.904 9 18.75l-.813-2.846a4.5 4.5 0 0 0-3.09-3.09L2.25 12l2.846-.813a4.5 4.5 0 0 0 3.09-3.09L9 5.25l.813 2.846a4.5 4.5 0 0 0 3.09 3.09L15.75 12l-2.846.813a4.5 4.5 0 0 0-3.09 3.09ZM18.259 8.715 18 9.75l-.259-1.035a3.375 3.375 0 0 0-2.455-2.456L14.25 6l1.036-.259a3.375 3.375 0 0 0 2.455-2.456L18 2.25l.259 1.035a3.375 3.375 0 0 0 2.456 2.456L21.75 6l-1.035.259a3.375 3.375 0 0 0-2.456 2.456Z" /></svg>
                  </button>
                </div>
              }
            </div>
          } @else {
            <div class="w-full h-full">
              <ng-container [ngTemplateOutlet]="imagePlaceholder"></ng-container>
            </div>
          }
        </div>
      }
      @case ('table') {
        <div class="flex flex-col w-full">
            <div class="relative group mb-6 text-center">
              <h2 class="text-4xl font-bold rounded-md outline-none focus:ring-2 focus:ring-purple-500/80 focus:bg-white/5"
                    [style.font-family]="theme().titleFont + ', serif'"
                    [style.color]="theme().primaryColor"
                    contenteditable="true"
                    (blur)="onContentChange('title', $event)"
                    [textContent]="slide().title"></h2>
              <button (click)="triggerImproveContent('title')" title="Improve with AI" class="absolute -right-0 top-1/2 -translate-y-1/2 opacity-0 group-hover:opacity-100 transition-opacity text-purple-400 hover:text-purple-300 p-1 hover:scale-110">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6"><path stroke-linecap="round" stroke-linejoin="round" d="M9.813 15.904 9 18.75l-.813-2.846a4.5 4.5 0 0 0-3.09-3.09L2.25 12l2.846-.813a4.5 4.5 0 0 0 3.09-3.09L9 5.25l.813 2.846a4.5 4.5 0 0 0 3.09 3.09L15.75 12l-2.846.813a4.5 4.5 0 0 0-3.09 3.09ZM18.259 8.715 18 9.75l-.259-1.035a3.375 3.375 0 0 0-2.455-2.456L14.25 6l1.036-.259a3.375 3.375 0 0 0 2.455-2.456L18 2.25l.259 1.035a3.375 3.375 0 0 0 2.456 2.456L21.75 6l-1.035.259a3.375 3.375 0 0 0-2.456 2.456Z" /></svg>
              </button>
            </div>
            @if (normalizedContent()[0]) {
                <p class="text-center text-lg mb-4">{{ normalizedContent()[0] }}</p>
            }
            <div class="flex-grow flex justify-center items-center">
              <div class="relative max-w-5xl w-full">
                <table class="w-full border-collapse">
                  @if (slide().tableData && slide().tableData!.length > 0) {
                    <thead>
                      <tr [style.background-color]="theme().primaryColor" [style.color]="theme().backgroundColor">
                        @for(cell of slide().tableData![0]; track c; let c = $index) {
                          <th class="p-3 font-bold text-left border relative group" [style.border-color]="theme().primaryColor">
                            <span contenteditable="true" (blur)="onTableDataChange($event, 0, c)" class="rounded-sm outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-gray-900 focus:ring-white/80 focus:bg-white/10">{{ cell }}</span>
                          </th>
                        }
                      </tr>
                    </thead>
                    <tbody>
                      @for (row of slide().tableData!.slice(1); track r; let r = $index) {
                        <tr class="[&:nth-child(even)]:bg-gray-800/20">
                          @for(cell of row; track c; let c = $index) {
                            <td class="p-3 border outline-none focus-within:bg-purple-900/50" [style.border-color]="theme().textColor + '40'">
                              <span contenteditable="true" (blur)="onTableDataChange($event, r + 1, c)" class="block rounded-sm outline-none focus:ring-2 focus:ring-purple-500/80 focus:bg-white/5">{{ cell }}</span>
                            </td>
                          }
                        </tr>
                      }
                    </tbody>
                  }
                </table>
                 <!-- Table Controls -->
                <div class="absolute -right-2 top-0 flex flex-col gap-1">
                  <button (click)="addColumn()" title="Add Column" class="w-6 h-6 bg-green-600/80 text-white rounded-full flex items-center justify-center text-sm font-mono leading-none hover:bg-green-500">+</button>
                  <button (click)="removeColumn(slide().tableData![0].length - 1)" title="Remove Last Column" class="w-6 h-6 bg-red-600/80 text-white rounded-full flex items-center justify-center text-xs font-mono leading-none hover:bg-red-500">-</button>
                </div>
                <div class="absolute -bottom-2 left-0 flex gap-1">
                  <button (click)="addRow()" title="Add Row" class="w-6 h-6 bg-green-600/80 text-white rounded-full flex items-center justify-center text-sm font-mono leading-none hover:bg-green-500">+</button>
                  <button (click)="removeRow(slide().tableData!.length - 1)" title="Remove Last Row" class="w-6 h-6 bg-red-600/80 text-white rounded-full flex items-center justify-center text-xs font-mono leading-none hover:bg-red-500">-</button>
                </div>
              </div>
            </div>
        </div>
      }
      @case ('chart_bar') {
        <div class="flex flex-col w-full h-full">
            <div class="relative group mb-4 text-center">
              <h2 class="text-4xl font-bold rounded-md outline-none focus:ring-2 focus:ring-purple-500/80 focus:bg-white/5"
                    [style.font-family]="theme().titleFont + ', serif'"
                    [style.color]="theme().primaryColor"
                    contenteditable="true" (blur)="onContentChange('title', $event)">
                {{ slide().title }}
              </h2>
            </div>
            @if (normalizedContent()[0]) {
                <p class="text-center text-lg mb-2">{{ normalizedContent()[0] }}</p>
            }
            <div class="flex-grow flex flex-col justify-end items-stretch p-4 gap-4">
              <!-- Chart Area with Y-axis -->
              <div class="flex-grow w-full flex gap-2">
                <!-- Y-Axis Labels -->
                <div class="flex flex-col justify-between items-end h-full text-xs pr-2" [style.color]="theme().textColor + '80'">
                  @for(label of yAxisLabels(); track label.value) {
                    <span>{{ label.value }}</span>
                  }
                </div>
                <!-- Chart Grid and Bars -->
                <div class="flex-grow w-full flex justify-around items-end gap-2 relative">
                  <!-- Grid lines -->
                  @for(label of yAxisLabels(); track label.value) {
                    @if (label.value > 0) {
                      <div class="absolute w-full border-t border-dashed" [style.bottom.%]="label.position" [style.border-color]="theme().textColor + '30'"></div>
                    }
                  }
                  <div class="absolute w-full h-full border-b border-l" [style.border-color]="theme().textColor + '80'"></div>
                  
                  @if(slide().chartData; as chart) {
                    @for (label of chart.labels; track l; let l_index = $index) {
                      <div class="flex flex-col items-center gap-2 flex-1 group relative z-10 h-full justify-end">
                        <!-- Bars -->
                        @for(dataset of chart.datasets; track d; let d_index = $index) {
                            <div class="w-1/2 rounded-t-md transition-all duration-300 hover:opacity-80" 
                                [style.height.%]="(dataset.data[l_index] / chartTopValue()) * 100"
                                [style.background-color]="barColors()[d_index]">
                            </div>
                            <!-- Value Tooltip -->
                             <div class="absolute -top-8 bg-gray-900 text-white px-2 py-1 rounded-md text-sm opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none outline-none focus:ring-2 focus:ring-purple-500/80"
                                  contenteditable="true"
                                  (blur)="onChartDataChange('value', $event, d_index, l_index)">
                                  {{ dataset.data[l_index] }}
                             </div>
                        }
                        <!-- Label -->
                         <div class="flex items-center gap-1 absolute -bottom-6">
                          <span class="text-sm font-semibold rounded-sm outline-none focus:ring-2 focus:ring-purple-500/80 focus:bg-white/5" contenteditable="true" (blur)="onChartDataChange('label', $event, 0, l_index)">{{ label }}</span>
                        </div>
                      </div>
                    }
                  }
                </div>
              </div>

              <!-- Legend & Controls -->
              <div class="flex justify-center items-center flex-wrap gap-x-4 gap-y-2 text-sm pt-8">
                 @if(slide().chartData; as chart) {
                  @for (dataset of chart.datasets; track d; let d_index = $index) {
                    <div class="flex items-center gap-2 group">
                      <div class="w-4 h-4 rounded" [style.background-color]="barColors()[d_index]"></div>
                      <span contenteditable="true" (blur)="onChartDataChange('datasetLabel', $event, d_index)" class="rounded-sm outline-none focus:ring-2 focus:ring-purple-500/80 focus:bg-white/5">{{ dataset.label }}</span>
                      <button (click)="removeChartDataset(d_index)" title="Remove Dataset" class="w-4 h-4 bg-red-600/80 text-white rounded-full flex items-center justify-center transition-opacity text-xs font-mono leading-none">-</button>
                    </div>
                  }
                  <button (click)="addChartDataset()" title="Add Dataset" class="w-6 h-6 bg-green-600/80 text-white rounded-full flex items-center justify-center text-sm font-mono leading-none hover:bg-green-500">+</button>
                  <div class="border-l border-gray-600 h-5 mx-2"></div>
                  <button (click)="addChartDataPoint()" title="Add Data Point" class="w-6 h-6 bg-green-600/80 text-white rounded-full flex items-center justify-center text-sm font-mono leading-none hover:bg-green-500">+</button>
                  <button (click)="removeChartDataPoint(chart.labels.length - 1)" title="Remove Last Data Point" class="w-6 h-6 bg-red-600/80 text-white rounded-full flex items-center justify-center text-xs font-mono leading-none hover:bg-red-500">-</button>
                 }
              </div>
            </div>
        </div>
      }
      @case ('chart_pie') {
        <div class="flex flex-col w-full h-full">
            <h2 class="text-4xl font-bold text-center mb-4 rounded-md outline-none focus:ring-2 focus:ring-purple-500/80 focus:bg-white/5"
                [style.font-family]="theme().titleFont + ', serif'"
                [style.color]="theme().primaryColor"
                contenteditable="true" (blur)="onContentChange('title', $event)">
                {{ slide().title }}
            </h2>
            @if (normalizedContent()[0]) {
                <p class="text-center text-lg mb-4">{{ normalizedContent()[0] }}</p>
            }
            <div class="flex-grow flex items-center justify-center gap-8">
                <div class="w-64 h-64 rounded-full" [style]="pieChartGradient()"></div>
                <div class="flex flex-col gap-2">
                    @if(slide().chartData; as chart) {
                        @for (label of chart.labels; track l; let i = $index) {
                            <div class="flex items-center gap-3">
                                <div class="w-5 h-5 rounded" [style.background-color]="barColors()[i]"></div>
                                <span class="text-lg rounded-sm outline-none focus:ring-2 focus:ring-purple-500/80 focus:bg-white/5" contenteditable="true" (blur)="onChartDataChange('label', $event, 0, i)">{{ label }}</span>
                                <span class="font-bold text-lg rounded-sm outline-none focus:ring-2 focus:ring-purple-500/80 focus:bg-white/5" contenteditable="true" (blur)="onChartDataChange('value', $event, 0, i)">
                                    {{ chart.datasets[0].data[i] }}
                                </span>
                                <button (click)="removeChartDataPoint(i)" title="Remove Data Point" class="ml-1 w-5 h-5 bg-red-600/80 text-white rounded-full flex items-center justify-center transition-opacity text-xs font-mono leading-none">-</button>
                            </div>
                        }
                        <button (click)="addChartDataPoint()" title="Add Data Point" class="mt-2 w-full text-sm py-1 bg-green-600/80 rounded hover:bg-green-700/80 flex items-center justify-center gap-2">
                          <span class="font-mono text-base">+</span> Add Data Point
                        </button>
                    }
                </div>
            </div>
        </div>
      }
      @case ('chart_doughnut') {
        <div class="flex flex-col w-full h-full">
            <h2 class="text-4xl font-bold text-center mb-4 rounded-md outline-none focus:ring-2 focus:ring-purple-500/80 focus:bg-white/5"
                [style.font-family]="theme().titleFont + ', serif'"
                [style.color]="theme().primaryColor"
                contenteditable="true" (blur)="onContentChange('title', $event)">
                {{ slide().title }}
            </h2>
            @if (normalizedContent()[0]) {
                <p class="text-center text-lg mb-4">{{ normalizedContent()[0] }}</p>
            }
            <div class="flex-grow flex items-center justify-center gap-8">
                <div class="w-64 h-64 rounded-full relative" [style]="pieChartGradient()">
                    <div class="absolute inset-8 rounded-full" [style.background-color]="theme().backgroundColor"></div>
                </div>
                <div class="flex flex-col gap-2">
                    @if(slide().chartData; as chart) {
                        @for (label of chart.labels; track l; let i = $index) {
                            <div class="flex items-center gap-3">
                                <div class="w-5 h-5 rounded" [style.background-color]="barColors()[i]"></div>
                                <span class="text-lg rounded-sm outline-none focus:ring-2 focus:ring-purple-500/80 focus:bg-white/5" contenteditable="true" (blur)="onChartDataChange('label', $event, 0, i)">{{ label }}</span>
                                <span class="font-bold text-lg rounded-sm outline-none focus:ring-2 focus:ring-purple-500/80 focus:bg-white/5" contenteditable="true" (blur)="onChartDataChange('value', $event, 0, i)">
                                    {{ chart.datasets[0].data[i] }}
                                </span>
                                <button (click)="removeChartDataPoint(i)" title="Remove Data Point" class="ml-1 w-5 h-5 bg-red-600/80 text-white rounded-full flex items-center justify-center transition-opacity text-xs font-mono leading-none">-</button>
                            </div>
                        }
                        <button (click)="addChartDataPoint()" title="Add Data Point" class="mt-2 w-full text-sm py-1 bg-green-600/80 rounded hover:bg-green-700/80 flex items-center justify-center gap-2">
                          <span class="font-mono text-base">+</span> Add Data Point
                        </button>
                    }
                </div>
            </div>
        </div>
      }
      @case ('chart_line') {
        <div class="flex flex-col w-full h-full">
            <h2 class="text-4xl font-bold text-center mb-2 rounded-md outline-none focus:ring-2 focus:ring-purple-500/80 focus:bg-white/5"
                [style.font-family]="theme().titleFont + ', serif'"
                [style.color]="theme().primaryColor"
                contenteditable="true" (blur)="onContentChange('title', $event)">
                {{ slide().title }}
            </h2>
            @if (normalizedContent()[0]) {
                <p class="text-center text-lg mb-2">{{ normalizedContent()[0] }}</p>
            }
            <div class="flex-grow flex flex-col items-center justify-center">
                <svg viewBox="0 0 800 400" class="w-full h-full">
                    <!-- Grid Lines & Y-Axis Labels -->
                    @for(line of lineChartPoints().grid; track line) {
                        <path [attr.d]="line" [attr.stroke]="theme().textColor + '30'" stroke-width="1"/>
                    }
                    @for(label of lineChartPoints().labels.y; track label) {
                        <text [attr.x]="label.x" [attr.y]="label.y" [attr.fill]="theme().textColor" text-anchor="end" alignment-baseline="middle" font-size="14">{{ label.text }}</text>
                    }
                    <!-- X-Axis Labels -->
                    @for(label of lineChartPoints().labels.x; track label) {
                        <text [attr.x]="label.x" [attr.y]="label.y" [attr.fill]="theme().textColor" text-anchor="middle" font-size="14">{{ label.text }}</text>
                    }
                    <!-- Lines -->
                    @for(line of lineChartPoints().lines; track line) {
                        <polyline [attr.points]="line.points" [attr.stroke]="line.color" stroke-width="3" fill="none" />
                    }
                </svg>
                 <!-- Legend & Controls -->
                <div class="flex justify-center items-center flex-wrap gap-x-4 gap-y-2 text-sm">
                    @if(slide().chartData; as chart) {
                        @for (dataset of chart.datasets; track d; let d_index = $index) {
                            <div class="flex items-center gap-2 group">
                              <div class="w-4 h-4 rounded" [style.background-color]="barColors()[d_index]"></div>
                              <span contenteditable="true" (blur)="onChartDataChange('datasetLabel', $event, d_index)" class="rounded-sm outline-none focus:ring-2 focus:ring-purple-500/80 focus:bg-white/5">{{ dataset.label }}</span>
                              <button (click)="removeChartDataset(d_index)" title="Remove Dataset" class="w-4 h-4 bg-red-600/80 text-white rounded-full flex items-center justify-center transition-opacity text-xs font-mono leading-none">-</button>
                            </div>
                        }
                        <button (click)="addChartDataset()" title="Add Dataset" class="w-6 h-6 bg-green-600/80 text-white rounded-full flex items-center justify-center text-sm font-mono leading-none hover:bg-green-500">+</button>
                         <div class="border-l border-gray-600 h-5 mx-2"></div>
                         <button (click)="addChartDataPoint()" title="Add Data Point" class="w-6 h-6 bg-green-600/80 text-white rounded-full flex items-center justify-center text-sm font-mono leading-none hover:bg-green-500">+</button>
                         <button (click)="removeChartDataPoint(chart.labels.length - 1)" title="Remove Last Data Point" class="w-6 h-6 bg-red-600/80 text-white rounded-full flex items-center justify-center text-xs font-mono leading-none hover:bg-red-500">-</button>
                    }
                </div>
            </div>
        </div>
      }
      @case ('timeline') {
        <div class="flex flex-col w-full">
            <div class="relative group mb-6 text-center">
              <h2 class="text-4xl font-bold rounded-md outline-none focus:ring-2 focus:ring-purple-500/80 focus:bg-white/5"
                    [style.font-family]="theme().titleFont + ', serif'"
                    [style.color]="theme().primaryColor"
                    contenteditable="true"
                    (blur)="onContentChange('title', $event)"
                    [textContent]="slide().title"></h2>
            </div>
            <div class="w-full max-w-4xl mx-auto mt-4 px-4">
              <div class="relative wrap overflow-hidden h-full">
                <div class="absolute h-full w-0.5 rounded-full" [style.background-color]="theme().primaryColor + '80'" style="left: 50%; transform: translateX(-50%);"></div>
                 @for (item of pairedListContent(); track i; let i = $index; let isEven = $even) {
                  <div class="mb-8 flex justify-between items-center w-full" [class.flex-row-reverse]="isEven">
                    <div class="order-1 w-5/12"></div>
                    <div class="z-20 flex items-center order-1 shadow-xl w-8 h-8 rounded-full" [style.background-color]="theme().primaryColor" [style.color]="theme().backgroundColor">
                      <h1 class="mx-auto font-semibold text-lg">{{i + 1}}</h1>
                    </div>
                    <div class="order-1 rounded-lg shadow-xl w-5/12 px-6 py-4" [style.background-color]="theme().textColor + '10'">
                      <div class="relative group">
                        <h3 class="mb-3 font-bold text-xl rounded-sm outline-none focus:ring-2 focus:ring-purple-500/80 focus:bg-white/5" [style.color]="theme().primaryColor" contenteditable="true" (blur)="onContentChange('item1', $event, i)">{{item.item1}}</h3>
                        <button (click)="triggerImproveContent('item1', i)" title="Improve with AI" class="absolute -right-4 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-purple-400 hover:text-purple-300 p-1 hover:scale-110">
                          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-4 h-4"><path stroke-linecap="round" stroke-linejoin="round" d="M9.813 15.904 9 18.75l-.813-2.846a4.5 4.5 0 0 0-3.09-3.09L2.25 12l2.846-.813a4.5 4.5 0 0 0 3.09-3.09L9 5.25l.813 2.846a4.5 4.5 0 0 0 3.09 3.09L15.75 12l-2.846.813a4.5 4.5 0 0 0-3.09 3.09ZM18.259 8.715 18 9.75l-.259-1.035a3.375 3.375 0 0 0-2.455-2.456L14.25 6l1.036-.259a3.375 3.375 0 0 0 2.455-2.456L18 2.25l.259 1.035a3.375 3.375 0 0 0 2.456 2.456L21.75 6l-1.035.259a3.375 3.375 0 0 0-2.456 2.456Z" /></svg>
                        </button>
                      </div>
                      <div class="relative group">
                        <p class="text-sm leading-snug tracking-wide rounded-sm outline-none focus:ring-2 focus:ring-purple-500/80 focus:bg-white/5" contenteditable="true" (blur)="onContentChange('item2', $event, i)">{{item.item2}}</p>
                         <button (click)="triggerImproveContent('item2', i)" title="Improve with AI" class="absolute -right-4 top-0 opacity-0 group-hover:opacity-100 transition-opacity text-purple-400 hover:text-purple-300 p-1 hover:scale-110">
                          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-4 h-4"><path stroke-linecap="round" stroke-linejoin="round" d="M9.813 15.904 9 18.75l-.813-2.846a4.5 4.5 0 0 0-3.09-3.09L2.25 12l2.846-.813a4.5 4.5 0 0 0 3.09-3.09L9 5.25l.813 2.846a4.5 4.5 0 0 0 3.09 3.09L15.75 12l-2.846.813a4.5 4.5 0 0 0-3.09 3.09ZM18.259 8.715 18 9.75l-.259-1.035a3.375 3.375 0 0 0-2.455-2.456L14.25 6l1.036-.259a3.375 3.375 0 0 0 2.455-2.456L18 2.25l.259 1.035a3.375 3.375 0 0 0 2.456 2.456L21.75 6l-1.035.259a3.375 3.375 0 0 0-2.456 2.456Z" /></svg>
                        </button>
                      </div>
                    </div>
                  </div>
                }
              </div>
            </div>
        </div>
      }
      @case ('process') {
        <div class="flex flex-col w-full">
            <div class="relative group mb-6 text-center">
              <h2 class="text-4xl font-bold rounded-md outline-none focus:ring-2 focus:ring-purple-500/80 focus:bg-white/5"
                    [style.font-family]="theme().titleFont + ', serif'"
                    [style.color]="theme().primaryColor"
                    contenteditable="true"
                    (blur)="onContentChange('title', $event)"
                    [textContent]="slide().title"></h2>
            </div>
            <div class="flex-grow flex items-center justify-center gap-4 px-4">
               @for (item of pairedListContent(); track i; let i = $index; let isLast = $last) {
                <div class="flex items-center gap-4 w-1/5">
                  <div class="flex flex-col items-center text-center p-4 rounded-lg flex-1" [style.background-color]="theme().textColor + '10'">
                    <div class="w-12 h-12 rounded-full flex items-center justify-center font-bold text-2xl mb-4" [style.background-color]="theme().primaryColor" [style.color]="theme().backgroundColor">
                      {{i + 1}}
                    </div>
                    <div class="relative group">
                      <h3 class="font-bold text-lg rounded-sm outline-none focus:ring-2 focus:ring-purple-500/80 focus:bg-white/5" contenteditable="true" (blur)="onContentChange('item1', $event, i)">{{item.item1}}</h3>
                    </div>
                     <div class="relative group mt-1">
                      <p class="text-sm rounded-sm outline-none focus:ring-2 focus:ring-purple-500/80 focus:bg-white/5" contenteditable="true" (blur)="onContentChange('item2', $event, i)">{{item.item2}}</p>
                    </div>
                  </div>
                  @if(!isLast) {
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 flex-shrink-0" [style.color]="theme().primaryColor" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                      <path stroke-linecap="round" stroke-linejoin="round" d="M13 7l5 5m0 0l-5 5m5-5H6" />
                    </svg>
                  }
                </div>
              }
            </div>
        </div>
      }
      @case ('stats_highlight') {
         <div class="flex flex-col w-full">
            <div class="relative group mb-6 text-center">
              <h2 class="text-4xl font-bold rounded-md outline-none focus:ring-2 focus:ring-purple-500/80 focus:bg-white/5"
                    [style.font-family]="theme().titleFont + ', serif'"
                    [style.color]="theme().primaryColor"
                    contenteditable="true"
                    (blur)="onContentChange('title', $event)"
                    [textContent]="slide().title"></h2>
            </div>
            <div class="flex-grow grid gap-8 items-center" [class]="statsGridColsClass()">
              @for (item of pairedListContent(); track i; let i = $index) {
                <div class="text-center p-6 bg-gray-800/50 rounded-lg border border-gray-700/50 shadow-lg">
                  <div class="relative group">
                    <p class="text-7xl font-bold rounded-sm outline-none focus:ring-2 focus:ring-purple-500/80 focus:bg-white/5" [style.color]="theme().primaryColor" contenteditable="true" (blur)="onContentChange('item1', $event, i)">{{item.item1}}</p>
                  </div>
                   <div class="relative group mt-2">
                    <p class="text-xl rounded-sm outline-none focus:ring-2 focus:ring-purple-500/80 focus:bg-white/5" contenteditable="true" (blur)="onContentChange('item2', $event, i)">{{item.item2}}</p>
                  </div>
                </div>
              }
            </div>
        </div>
      }
      @case ('pyramid') {
        <div class="flex flex-col w-full h-full items-center">
          <div class="relative group mb-6 text-center">
            <h2 class="text-4xl font-bold rounded-md outline-none focus:ring-2 focus:ring-purple-500/80 focus:bg-white/5"
                [style.font-family]="theme().titleFont + ', serif'"
                [style.color]="theme().primaryColor"
                contenteditable="true" (blur)="onContentChange('title', $event)">
                {{ slide().title }}
            </h2>
          </div>
          <div class="flex-grow flex items-center justify-center w-full">
            <div class="w-2/3">
              @for(item of pyramidContent(); track i; let i = $index; let count = $count) {
                <div class="relative group" [style.clip-path]="'polygon(' + (i * 8) + '% 0%, ' + (100 - i * 8) + '% 0%, 100% 100%, 0% 100%)'">
                  <div class="px-4 py-3 text-center"
                       [style.background-color]="theme().primaryColor"
                       [style.opacity]="1 - i * (0.8 / count)"
                       [style.color]="theme().backgroundColor">
                    <span class="font-bold text-lg rounded-sm outline-none focus:ring-2 focus:ring-white/50 focus:bg-white/10"
                          contenteditable="true"
                          (blur)="onContentChange('content', $event, i)">
                      {{item}}
                    </span>
                  </div>
                </div>
              }
            </div>
          </div>
        </div>
      }
      @case ('funnel') {
        <div class="flex flex-col w-full h-full items-center">
          <div class="relative group mb-6 text-center">
            <h2 class="text-4xl font-bold rounded-md outline-none focus:ring-2 focus:ring-purple-500/80 focus:bg-white/5"
                [style.font-family]="theme().titleFont + ', serif'"
                [style.color]="theme().primaryColor"
                contenteditable="true" (blur)="onContentChange('title', $event)">
                {{ slide().title }}
            </h2>
          </div>
          <div class="flex-grow flex flex-col items-center justify-center w-full max-w-lg">
            @for(item of funnelContent(); track i; let i = $index; let count = $count) {
              <div class="relative group w-full flex items-center flex-col">
                <div class="w-full text-center px-4 py-3"
                     [style.width.%]="100 - (i * (60 / count))"
                     [style.background-color]="theme().primaryColor"
                     [style.opacity]="1 - i * (0.6 / count)"
                     [style.color]="theme().backgroundColor">
                  <span class="font-semibold text-lg rounded-sm outline-none focus:ring-2 focus:ring-white/50 focus:bg-white/10"
                        contenteditable="true" (blur)="onContentChange('content', $event, i)">
                    {{ item }}
                  </span>
                </div>
                @if (i < count - 1) {
                  <div class="w-0 h-0 border-l-[20px] border-l-transparent border-r-[20px] border-r-transparent border-t-[20px]"
                       [style.border-top-color]="theme().primaryColor"
                       [style.opacity]="1 - i * (0.6 / count)"></div>
                }
              </div>
            }
          </div>
        </div>
      }
      @case ('swot') {
        <div class="flex flex-col w-full h-full">
          <div class="relative group mb-6 text-center">
            <h2 class="text-4xl font-bold rounded-md outline-none focus:ring-2 focus:ring-purple-500/80 focus:bg-white/5"
                [style.font-family]="theme().titleFont + ', serif'"
                [style.color]="theme().primaryColor"
                contenteditable="true" (blur)="onContentChange('title', $event)">
                {{ slide().title }}
            </h2>
          </div>
          @if(swotContent(); as swot) {
            <div class="flex-grow grid grid-cols-2 grid-rows-2 gap-4">
              <!-- Strengths -->
              <div class="bg-green-900/40 rounded-lg p-4 border border-green-700/50">
                <h3 class="text-2xl font-bold text-green-300 rounded-sm outline-none focus:ring-2 focus:ring-purple-500/80" contenteditable="true" (blur)="onContentChange('content', $event, 0)">{{swot.strengths.title}}</h3>
                <p class="mt-2 text-green-100 rounded-sm outline-none focus:ring-2 focus:ring-purple-500/80" contenteditable="true" (blur)="onContentChange('content', $event, 1)">{{swot.strengths.text}}</p>
              </div>
              <!-- Weaknesses -->
              <div class="bg-red-900/40 rounded-lg p-4 border border-red-700/50">
                <h3 class="text-2xl font-bold text-red-300 rounded-sm outline-none focus:ring-2 focus:ring-purple-500/80" contenteditable="true" (blur)="onContentChange('content', $event, 2)">{{swot.weaknesses.title}}</h3>
                <p class="mt-2 text-red-100 rounded-sm outline-none focus:ring-2 focus:ring-purple-500/80" contenteditable="true" (blur)="onContentChange('content', $event, 3)">{{swot.weaknesses.text}}</p>
              </div>
              <!-- Opportunities -->
              <div class="bg-blue-900/40 rounded-lg p-4 border border-blue-700/50">
                <h3 class="text-2xl font-bold text-blue-300 rounded-sm outline-none focus:ring-2 focus:ring-purple-500/80" contenteditable="true" (blur)="onContentChange('content', $event, 4)">{{swot.opportunities.title}}</h3>
                <p class="mt-2 text-blue-100 rounded-sm outline-none focus:ring-2 focus:ring-purple-500/80" contenteditable="true" (blur)="onContentChange('content', $event, 5)">{{swot.opportunities.text}}</p>
              </div>
              <!-- Threats -->
              <div class="bg-yellow-900/40 rounded-lg p-4 border border-yellow-700/50">
                <h3 class="text-2xl font-bold text-yellow-300 rounded-sm outline-none focus:ring-2 focus:ring-purple-500/80" contenteditable="true" (blur)="onContentChange('content', $event, 6)">{{swot.threats.title}}</h3>
                <p class="mt-2 text-yellow-100 rounded-sm outline-none focus:ring-2 focus:ring-purple-500/80" contenteditable="true" (blur)="onContentChange('content', $event, 7)">{{swot.threats.text}}</p>
              </div>
            </div>
          }
        </div>
      }
      @case('comparison') {
        <div class="flex flex-col w-full">
            <div class="relative group mb-6 text-center">
              <h2 class="text-4xl font-bold rounded-md outline-none focus:ring-2 focus:ring-purple-500/80 focus:bg-white/5"
                  [style.font-family]="theme().titleFont + ', serif'"
                  [style.color]="theme().primaryColor"
                  contenteditable="true"
                  (blur)="onContentChange('title', $event)"
                  [textContent]="slide().title"></h2>
            </div>
            @if(comparisonContent(); as comp) {
              <div class="flex-grow flex gap-8">
                <!-- Item A -->
                <div class="w-1/2 p-6 rounded-lg border" [style.border-color]="theme().textColor + '30'">
                  <h3 class="text-2xl font-bold text-center mb-4 rounded-md outline-none" [style.color]="theme().primaryColor" contenteditable="true" (blur)="onContentChange('content', $event, 0)">{{ comp.itemA.title }}</h3>
                  <ul class="list-disc pl-5 space-y-2 text-lg">
                    @for(point of comp.itemA.points; track i; let i = $index) {
                      <li class="relative group break-words">
                        <span contenteditable="true" (blur)="onContentChange('content', $event, i + 1)" [textContent]="point" class="rounded-md outline-none focus:ring-2 focus:ring-purple-500/80 focus:bg-white/5"></span>
                      </li>
                    }
                  </ul>
                </div>
                <!-- Item B -->
                <div class="w-1/2 p-6 rounded-lg border" [style.border-color]="theme().textColor + '30'">
                  <h3 class="text-2xl font-bold text-center mb-4 rounded-md outline-none" [style.color]="theme().primaryColor" contenteditable="true" (blur)="onContentChange('content', $event, (comparisonContent()?.itemA.points.length || 0) + 2)">{{ comp.itemB.title }}</h3>
                  <ul class="list-disc pl-5 space-y-2 text-lg">
                    @for(point of comp.itemB.points; track i; let i = $index) {
                      <li class="relative group break-words">
                        <span contenteditable="true" (blur)="onContentChange('content', $event, i + (comparisonContent()?.itemA.points.length || 0) + 3)" [textContent]="point" class="rounded-md outline-none focus:ring-2 focus:ring-purple-500/80 focus:bg-white/5"></span>
                      </li>
                    }
                  </ul>
                </div>
              </div>
            }
        </div>
      }
      @case('team_members_four') {
        <div class="flex flex-col w-full">
          <div class="relative group mb-8 text-center">
            <h2 class="text-4xl font-bold rounded-md outline-none focus:ring-2 focus:ring-purple-500/80 focus:bg-white/5"
                [style.font-family]="theme().titleFont + ', serif'"
                [style.color]="theme().primaryColor"
                contenteditable="true"
                (blur)="onContentChange('title', $event)"
                [textContent]="slide().title"></h2>
          </div>
          <div class="flex-grow grid grid-cols-2 md:grid-cols-4 gap-8 items-center">
            @for(member of teamMembersContent(); track i; let i = $index) {
              <div class="text-center flex flex-col items-center">
                <div class="w-32 h-32 rounded-full mb-4 bg-gray-700/50 flex items-center justify-center border-4" [style.border-color]="theme().primaryColor + '80'">
                  <svg xmlns="http://www.w3.org/2000/svg" class="w-16 h-16 text-gray-500" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z" clip-rule="evenodd" /></svg>
                </div>
                <h3 class="text-xl font-bold rounded-md outline-none" contenteditable="true" (blur)="onContentChange('content', $event, i * 2)">{{ member.name }}</h3>
                <p class="text-base text-gray-400 rounded-md outline-none" [style.color]="theme().primaryColor" contenteditable="true" (blur)="onContentChange('content', $event, i * 2 + 1)">{{ member.title }}</p>
              </div>
            }
          </div>
        </div>
      }
      @case('radial_diagram') {
        <div class="flex flex-col w-full h-full items-center">
          <div class="relative group mb-8 text-center">
            <h2 class="text-4xl font-bold rounded-md outline-none focus:ring-2 focus:ring-purple-500/80 focus:bg-white/5"
                [style.font-family]="theme().titleFont + ', serif'"
                [style.color]="theme().primaryColor"
                contenteditable="true" (blur)="onContentChange('title', $event)">
                {{ slide().title }}
            </h2>
          </div>
          @if(radialDiagramContent(); as radial) {
          <div class="flex-grow flex items-center justify-center w-full relative">
            <!-- Lines connecting center to satellites -->
            @for (satellite of radial.satellites; track i; let i = $index; let count = $count) {
              <div class="absolute top-1/2 left-1/2 h-0.5 w-[30%] origin-left" [style.background-color]="theme().primaryColor + '80'" [style.transform]="'rotate(' + (i * (360 / count)) + 'deg)'"></div>
            }
      
            <!-- Center Node -->
            <div class="w-48 h-48 rounded-full flex items-center justify-center text-center p-4 z-10" [style.background-color]="theme().primaryColor">
              <h3 class="text-2xl font-bold" [style.color]="theme().backgroundColor" contenteditable="true" (blur)="onContentChange('content', $event, 0)">{{ radial.center }}</h3>
            </div>
      
            <!-- Satellite Nodes -->
            @for (satellite of radial.satellites; track i; let i = $index; let count = $count) {
              <div class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-36 h-36 rounded-full flex items-center justify-center text-center p-2 z-10" 
                   [style.background-color]="theme().textColor + '20'"
                   [style.transform]="'rotate(' + (i * (360 / count)) + 'deg) translate(250px) rotate(' + -(i * (360 / count)) + 'deg)'">
                <p contenteditable="true" (blur)="onContentChange('content', $event, i + 1)">{{ satellite }}</p>
              </div>
            }
          </div>
          }
        </div>
      }
      @case('step_flow') {
        <div class="flex flex-col w-full h-full">
          <div class="relative group mb-8 text-center">
            <h2 class="text-4xl font-bold rounded-md outline-none focus:ring-2 focus:ring-purple-500/80 focus:bg-white/5"
                [style.font-family]="theme().titleFont + ', serif'"
                [style.color]="theme().primaryColor"
                contenteditable="true" (blur)="onContentChange('title', $event)">
                {{ slide().title }}
            </h2>
          </div>
          <div class="flex-grow flex items-center justify-center px-4">
            @for (step of stepFlowContent(); track i; let i = $index; let count = $count) {
              <div class="relative h-24 flex-1 flex items-center justify-center px-8 text-center font-bold"
                   [style.background-color]="theme().primaryColor"
                   [style.color]="theme().backgroundColor"
                   [style.opacity]="1 - (i * (0.6 / count))"
                   [style.clip-path]="'polygon(0% 0%, calc(100% - 30px) 0, 100% 50%, calc(100% - 30px) 100%, 0% 100%, 30px 50%)'"
                   [style.margin-left]="i > 0 ? '-30px' : '0'"
                   [style.z-index]="count - i"
                   >
                <p contenteditable="true" (blur)="onContentChange('content', $event, i)">
                   {{ step }}
                </p>
              </div>
            }
          </div>
        </div>
      }
      <!-- START: NEWLY IMPLEMENTED LAYOUTS -->
      @case('image_overlap_left') {
        <div class="w-full h-full relative flex items-center">
          <div class="absolute inset-0 w-2/3 h-full overflow-hidden">
            <ng-container [ngTemplateOutlet]="imagePlaceholder"></ng-container>
          </div>
          <div class="relative w-1/2 ml-auto p-8 rounded-lg shadow-2xl" [style.background-color]="theme().backgroundColor + 'E6'">
            <div class="relative group mb-4">
              <h2 class="text-4xl font-bold" [style.font-family]="theme().titleFont + ', serif'" [style.color]="theme().primaryColor" contenteditable="true" (blur)="onContentChange('title', $event)">{{ slide().title }}</h2>
            </div>
            <ul class="list-disc pl-5 space-y-2 text-xl">
              @for(item of normalizedContent(); track i; let i = $index) {
                <li class="relative group break-words">
                  <span contenteditable="true" (blur)="onContentChange('content', $event, i)" [textContent]="item"></span>
                </li>
              }
            </ul>
          </div>
        </div>
      }
      @case('hub_and_spoke') {
        <div class="flex flex-col w-full h-full items-center">
          <div class="relative group mb-8 text-center">
            <h2 class="text-4xl font-bold" [style.font-family]="theme().titleFont + ', serif'" [style.color]="theme().primaryColor" contenteditable="true" (blur)="onContentChange('title', $event)">{{ slide().title }}</h2>
          </div>
          @if(hubAndSpokeContent(); as content) {
            <div class="flex-grow flex items-center justify-center w-full relative">
              @for (spoke of content.spokes; track i; let i = $index; let count = $count) {
                <div class="absolute top-1/2 left-1/2 h-0.5 w-1/4 origin-left" [style.background-color]="theme().primaryColor + '80'" [style.transform]="'rotate(' + (i * (360 / count)) + 'deg)'"></div>
              }
              <div class="w-48 h-48 rounded-full flex items-center justify-center text-center p-4 z-10" [style.background-color]="theme().primaryColor">
                <h3 class="text-2xl font-bold" [style.color]="theme().backgroundColor" contenteditable="true" (blur)="onContentChange('content', $event, 0)">{{ content.center }}</h3>
              </div>
              @for (spoke of content.spokes; track i; let i = $index; let count = $count) {
                <div class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-32 h-32 rounded-lg flex items-center justify-center text-center p-2 z-10" [style.background-color]="theme().textColor + '20'" [style.transform]="'rotate(' + (i * (360 / count)) + 'deg) translate(220px) rotate(' + -(i * (360 / count)) + 'deg)'">
                  <p contenteditable="true" (blur)="onContentChange('content', $event, i + 1)">{{ spoke }}</p>
                </div>
              }
            </div>
          }
        </div>
      }
      @case('cycle_diagram') {
        <div class="flex flex-col w-full h-full items-center">
          <div class="relative group mb-8 text-center">
            <h2 class="text-4xl font-bold" [style.font-family]="theme().titleFont + ', serif'" [style.color]="theme().primaryColor" contenteditable="true" (blur)="onContentChange('title', $event)">{{ slide().title }}</h2>
          </div>
          <div class="flex-grow flex items-center justify-center w-full relative h-96 w-96">
            @for(item of cycleDiagramContent(); track i; let i = $index; let count = $count) {
              <div class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-32 h-24 rounded-lg flex items-center justify-center text-center p-2 z-10" [style.background-color]="theme().textColor + '20'" [style.transform]="'rotate(' + (i * (360 / count)) + 'deg) translate(150px) rotate(' + -(i * (360 / count)) + 'deg)'">
                <p contenteditable="true" (blur)="onContentChange('content', $event, i)">{{ item }}</p>
              </div>
            }
          </div>
        </div>
      }
      @case('venn_diagram') {
        <div class="flex flex-col w-full h-full items-center">
          <div class="relative group mb-8 text-center">
            <h2 class="text-4xl font-bold" [style.font-family]="theme().titleFont + ', serif'" [style.color]="theme().primaryColor" contenteditable="true" (blur)="onContentChange('title', $event)">{{ slide().title }}</h2>
          </div>
          @if(vennDiagramContent(); as venn) {
            <div class="flex-grow flex items-center justify-center w-full relative">
              <div class="w-64 h-64 rounded-full border-4 opacity-70" [style.border-color]="theme().primaryColor" style="transform: translateX(30%)"></div>
              <div class="w-64 h-64 rounded-full border-4 opacity-70" [style.border-color]="theme().textColor" style="transform: translateX(-30%)"></div>
              <div class="absolute top-1/2 -translate-y-1/2 text-center" style="transform: translate(-90%, -50%)">
                <h3 class="font-bold text-lg" contenteditable="true" (blur)="onContentChange('content', $event, 0)">{{ venn.itemA.title }}</h3>
                <p class="text-sm" contenteditable="true" (blur)="onContentChange('content', $event, 1)">{{ venn.itemA.text }}</p>
              </div>
              <div class="absolute top-1/2 -translate-y-1/2 text-center" style="transform: translate(90%, -50%)">
                <h3 class="font-bold text-lg" contenteditable="true" (blur)="onContentChange('content', $event, 2)">{{ venn.itemB.title }}</h3>
                <p class="text-sm" contenteditable="true" (blur)="onContentChange('content', $event, 3)">{{ venn.itemB.text }}</p>
              </div>
              <div class="absolute top-1/2 -translate-y-1/2 text-center">
                <h3 class="font-bold text-lg" contenteditable="true" (blur)="onContentChange('content', $event, 4)">{{ venn.intersection.title }}</h3>
                <p class="text-sm" contenteditable="true" (blur)="onContentChange('content', $event, 5)">{{ venn.intersection.text }}</p>
              </div>
            </div>
          }
        </div>
      }
      @case('alternating_feature_list') {
         <div class="flex flex-col w-full">
            <div class="relative group mb-6 text-center">
              <h2 class="text-4xl font-bold" [style.font-family]="theme().titleFont + ', serif'" [style.color]="theme().primaryColor" contenteditable="true" (blur)="onContentChange('title', $event)">{{ slide().title }}</h2>
            </div>
            <div class="w-full max-w-4xl mx-auto mt-4 space-y-8">
              @for(item of alternatingFeatureListContent(); track i; let i = $index; let isEven = $even) {
                <div class="flex" [class.justify-end]="isEven">
                  <div class="w-2/3 p-4 rounded-lg" [style.background-color]="theme().textColor + '10'">
                      <div class="relative group">
                          <h3 class="font-bold text-2xl mb-2" [style.color]="theme().primaryColor" contenteditable="true" (blur)="onContentChange('item1', $event, i)">{{ item.item1 }}</h3>
                      </div>
                      <div class="relative group">
                          <p contenteditable="true" (blur)="onContentChange('item2', $event, i)">{{ item.item2 }}</p>
                      </div>
                  </div>
                </div>
              }
            </div>
        </div>
      }
      @case ('image_focus_left') {
        <div class="flex w-full items-center gap-8">
          <div class="w-2/3 h-full">
            <ng-container [ngTemplateOutlet]="imagePlaceholder"></ng-container>
          </div>
          <div class="w-1/3">
            <div class="relative group mb-4">
              <h2 class="text-3xl font-bold" [style.font-family]="theme().titleFont + ', serif'" [style.color]="theme().primaryColor" contenteditable="true" (blur)="onContentChange('title', $event)">{{ slide().title }}</h2>
            </div>
            <ul class="space-y-2 text-lg">
              @for(item of normalizedContent(); track i; let i = $index) {
                <li class="relative group break-words">
                   <span contenteditable="true" (blur)="onContentChange('content', $event, i)" [textContent]="item"></span>
                </li>
              }
            </ul>
          </div>
        </div>
      }
      @case ('image_focus_right') {
        <div class="flex w-full items-center gap-8">
          <div class="w-1/3">
            <div class="relative group mb-4">
              <h2 class="text-3xl font-bold" [style.font-family]="theme().titleFont + ', serif'" [style.color]="theme().primaryColor" contenteditable="true" (blur)="onContentChange('title', $event)">{{ slide().title }}</h2>
            </div>
            <ul class="space-y-2 text-lg">
              @for(item of normalizedContent(); track i; let i = $index) {
                <li class="relative group break-words">
                   <span contenteditable="true" (blur)="onContentChange('content', $event, i)" [textContent]="item"></span>
                </li>
              }
            </ul>
          </div>
          <div class="w-2/3 h-full">
            <ng-container [ngTemplateOutlet]="imagePlaceholder"></ng-container>
          </div>
        </div>
      }
      @case ('feature_list_icons') {
        <div class="flex flex-col w-full">
            <div class="relative group mb-8 text-center">
              <h2 class="text-4xl font-bold" [style.font-family]="theme().titleFont + ', serif'" [style.color]="theme().primaryColor" contenteditable="true" (blur)="onContentChange('title', $event)">{{ slide().title }}</h2>
            </div>
            <div class="flex-grow grid grid-cols-1 md:grid-cols-3 gap-x-8 gap-y-12 items-start">
              @for(item of featureListIconsContent(); track i; let i = $index) {
                <div class="flex items-start gap-4">
                  <div class="p-3 rounded-full" [style.background-color]="theme().primaryColor + '30'">
                    <span class="material-symbols-outlined text-3xl" [style.color]="theme().primaryColor">{{ item.icon }}</span>
                  </div>
                  <div>
                    <p contenteditable="true" (blur)="onContentChange('content', $event, i * 2 + 1)">{{ item.text }}</p>
                  </div>
                </div>
              }
            </div>
        </div>
      }
       @case('pros_and_cons') {
        <div class="flex flex-col w-full">
            <div class="relative group mb-6 text-center">
              <h2 class="text-4xl font-bold" [style.font-family]="theme().titleFont + ', serif'" [style.color]="theme().primaryColor" contenteditable="true" (blur)="onContentChange('title', $event)">{{ slide().title }}</h2>
            </div>
            @if(prosAndConsContent(); as content) {
              <div class="flex-grow flex gap-8">
                <!-- Pros -->
                <div class="w-1/2 p-6 rounded-lg border border-green-700/50" [style.background-color]="'#16653430'">
                  <h3 class="text-2xl font-bold text-center mb-4 text-green-300">Pros</h3>
                  <ul class="list-disc pl-5 space-y-2 text-lg">
                    @for(point of content.pros; track i; let i = $index) {
                      <li class="relative group break-words">
                        <span contenteditable="true" (blur)="onContentChange('content', $event, i)" [textContent]="point"></span>
                      </li>
                    }
                  </ul>
                </div>
                <!-- Cons -->
                <div class="w-1/2 p-6 rounded-lg border border-red-700/50" [style.background-color]="'#991b1b30'">
                  <h3 class="text-2xl font-bold text-center mb-4 text-red-300">Cons</h3>
                  <ul class="list-disc pl-5 space-y-2 text-lg">
                    @for(point of content.cons; track i; let i = $index) {
                      <li class="relative group break-words">
                        <span contenteditable="true" (blur)="onContentChange('content', $event, i + content.pros.length + 1)" [textContent]="point"></span>
                      </li>
                    }
                  </ul>
                </div>
              </div>
            }
        </div>
      }
      @case ('kpi_dashboard_three') {
         <div class="flex flex-col w-full h-full">
            <div class="relative group mb-6 text-center">
              <h2 class="text-4xl font-bold" [style.font-family]="theme().titleFont + ', serif'" [style.color]="theme().primaryColor" contenteditable="true" (blur)="onContentChange('title', $event)">{{ slide().title }}</h2>
            </div>
            <div class="flex-grow grid grid-cols-3 gap-8 items-stretch">
              @for (item of pairedListContent(); track i; let i = $index) {
                <div class="text-center p-8 rounded-lg border h-full flex flex-col justify-center" [style.background-color]="theme().textColor + '10'" [style.border-color]="theme().textColor + '20'">
                  <div class="relative group">
                    <p class="text-5xl font-bold break-words" [style.color]="theme().primaryColor" contenteditable="true" (blur)="onContentChange('item1', $event, i)">{{item.item1}}</p>
                  </div>
                   <div class="relative group mt-4">
                    <p class="text-xl break-words" contenteditable="true" (blur)="onContentChange('item2', $event, i)">{{item.item2}}</p>
                  </div>
                </div>
              }
            </div>
        </div>
      }
      @case ('kpi_dashboard_four') {
         <div class="flex flex-col w-full h-full">
            <div class="relative group mb-6 text-center">
              <h2 class="text-4xl font-bold" [style.font-family]="theme().titleFont + ', serif'" [style.color]="theme().primaryColor" contenteditable="true" (blur)="onContentChange('title', $event)">{{ slide().title }}</h2>
            </div>
            <div class="flex-grow grid grid-cols-2 grid-rows-2 gap-6 items-stretch">
              @for (item of pairedListContent(); track i; let i = $index) {
                <div class="text-center p-6 rounded-lg border h-full flex flex-col justify-center" [style.background-color]="theme().textColor + '10'" [style.border-color]="theme().textColor + '20'">
                  <div class="relative group">
                    <p class="text-4xl font-bold break-words" [style.color]="theme().primaryColor" contenteditable="true" (blur)="onContentChange('item1', $event, i)">{{item.item1}}</p>
                  </div>
                   <div class="relative group mt-2">
                    <p class="text-lg break-words" contenteditable="true" (blur)="onContentChange('item2', $event, i)">{{item.item2}}</p>
                  </div>
                </div>
              }
            </div>
        </div>
      }
      @case ('faq') {
        <div class="flex flex-col w-full">
            <div class="relative group mb-8 text-center">
              <h2 class="text-4xl font-bold" [style.font-family]="theme().titleFont + ', serif'" [style.color]="theme().primaryColor" contenteditable="true" (blur)="onContentChange('title', $event)">{{ slide().title }}</h2>
            </div>
            <div class="w-full max-w-4xl mx-auto mt-4 space-y-6">
              @for(item of pairedListContent(); track i; let i = $index) {
                <div>
                  <h3 class="font-bold text-xl mb-2" [style.color]="theme().primaryColor" contenteditable="true" (blur)="onContentChange('item1', $event, i)">Q: {{ item.item1 }}</h3>
                  <p class="pl-4 border-l-4" [style.border-color]="theme().primaryColor + '80'" contenteditable="true" (blur)="onContentChange('item2', $event, i)">{{ item.item2 }}</p>
                </div>
              }
            </div>
        </div>
      }
      @case ('checklist') {
        <div class="flex flex-col w-full">
            <div class="relative group mb-8 text-center">
              <h2 class="text-4xl font-bold" [style.font-family]="theme().titleFont + ', serif'" [style.color]="theme().primaryColor" contenteditable="true" (blur)="onContentChange('title', $event)">{{ slide().title }}</h2>
            </div>
            <ul class="space-y-4 text-xl w-full max-w-2xl mx-auto">
              @for(item of normalizedContent(); track i; let i = $index) {
                <li class="flex items-start gap-4">
                  <span class="material-symbols-outlined text-2xl mt-1" [style.color]="theme().primaryColor">check_circle</span>
                  <span contenteditable="true" (blur)="onContentChange('content', $event, i)">{{ item }}</span>
                </li>
              }
            </ul>
        </div>
      }
       @case ('numbered_list_large') {
        <div class="flex flex-col w-full">
            <div class="relative group mb-8 text-center">
              <h2 class="text-4xl font-bold" [style.font-family]="theme().titleFont + ', serif'" [style.color]="theme().primaryColor" contenteditable="true" (blur)="onContentChange('title', $event)">{{ slide().title }}</h2>
            </div>
            <ul class="space-y-6 text-xl w-full max-w-3xl mx-auto">
              @for(item of normalizedContent(); track i; let i = $index) {
                <li class="flex items-start gap-6">
                  <div class="flex-shrink-0 text-5xl font-bold -mt-2" [style.color]="theme().primaryColor">{{ (i + 1).toString().padStart(2, '0') }}</div>
                  <span contenteditable="true" (blur)="onContentChange('content', $event, i)">{{ item }}</span>
                </li>
              }
            </ul>
        </div>
      }
      <!-- END: NEWLY IMPLEMENTED LAYOUTS -->
      @default {
        @if (!isPreview()) {
          <div class="flex w-full items-center justify-center">
            <p class="text-gray-500">Unknown or unsupported slide layout: {{ slide().layout }}</p>
          </div>
        } @else {
          <!-- During live generation, just show a blank slide. The content will type in shortly. -->
          <div class="w-full h-full flex items-center justify-center"></div>
        }
      }
    }
  </div>

  <!-- Reusable Image Placeholder & Generation UI -->
  <ng-template #imagePlaceholder>
    <div (paste)="handleImagePaste($event)" class="w-full h-full bg-gray-800/50 rounded-lg flex items-center justify-center relative group overflow-hidden border-2 border-dashed border-gray-600 hover:border-purple-500/80 transition-colors">
      @if (slide().imageUrl) {
        <img [src]="slide().imageUrl" alt="{{ slide().imagePrompt }}" class="w-full h-full object-cover">
        <!-- AI Action Buttons for Media -->
        <div class="absolute top-2 right-2 z-20 flex flex-col gap-2 opacity-0 group-hover:opacity-100 transition-opacity">
            <button (click)="editImage.emit()" title="Edit Image with AI" class="p-2 bg-gray-800/70 text-white rounded-full hover:bg-purple-600">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path d="M13.586 3.586a2 2 0 112.828 2.828l-.793.793-2.828-2.828.793-.793zM11.379 5.793L3 14.172V17h2.828l8.38-8.379-2.83-2.828z" /></svg>
            </button>
            <button (click)="generateContentFromImage.emit()" title="Generate Content from Image" class="p-2 bg-gray-800/70 text-white rounded-full hover:bg-purple-600">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M4 4a2 2 0 00-2 2v4a2 2 0 002 2h4v4a2 2 0 002 2h4a2 2 0 002-2v-4a2 2 0 00-2-2h-4V6a2 2 0 00-2-2H4zm2 6a2 2 0 100-4 2 2 0 000 4zm8-2a2 2 0 11-4 0 2 2 0 014 0z" clip-rule="evenodd" /></svg>
            </button>
            <button (click)="removeImage.emit()" title="Remove Image" class="p-2 bg-gray-800/70 text-white rounded-full hover:bg-red-600">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z" clip-rule="evenodd" /></svg>
            </button>
        </div>
      } @else {
        @if (slide().isGeneratingImage) {
          <div class="flex flex-col items-center justify-center text-center">
            <svg class="animate-spin h-8 w-8 text-purple-400" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg>
            <p class="mt-4 text-lg text-gray-300">Generating Image...</p>
            <p class="text-sm text-gray-500">This can take a moment.</p>
          </div>
        } @else {
          <div class="text-center p-4 w-full h-full flex flex-col justify-center">
            <div class="flex-grow flex flex-col justify-center">
                <svg xmlns="http://www.w3.org/2000/svg" class="mx-auto h-12 w-12 text-gray-500" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z" /></svg>
                <p class="mt-2 text-sm text-gray-400">No image generated.<br>You can paste an image here.</p>
            </div>
            <div class="relative group/prompt">
              <textarea [ngModel]="slide().imagePrompt" (ngModelChange)="onImagePromptChange($event)" rows="3" placeholder="Enter image prompt..."
                        class="w-full bg-gray-900/50 border-gray-600 rounded-md shadow-sm p-2 text-white text-sm focus:ring-purple-500 focus:border-purple-500"></textarea>
              <div class="absolute top-1 right-1 flex items-center gap-1 opacity-0 group-hover/prompt:opacity-100 transition-opacity">
                <button (click)="copyImagePrompt()" title="Copy Prompt" class="p-1.5 bg-gray-700 hover:bg-gray-600 text-white rounded-md">
                    @if(!isPromptCopied()) {
                      <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z" /></svg>
                    } @else {
                      <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-green-400" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" /></svg>
                    }
                </button>
                 <button (click)="improveImagePrompt.emit()" title="Improve prompt with AI" class="p-1.5 bg-gray-700 hover:bg-gray-600 text-white rounded-md">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-4 h-4"><path stroke-linecap="round" stroke-linejoin="round" d="M9.813 15.904 9 18.75l-.813-2.846a4.5 4.5 0 0 0-3.09-3.09L2.25 12l2.846-.813a4.5 4.5 0 0 0 3.09-3.09L9 5.25l.813 2.846a4.5 4.5 0 0 0 3.09 3.09L15.75 12l-2.846.813a4.5 4.5 0 0 0-3.09 3.09ZM18.259 8.715 18 9.75l-.259-1.035a3.375 3.375 0 0 0-2.455-2.456L14.25 6l1.036-.259a3.375 3.375 0 0 0 2.455-2.456L18 2.25l.259 1.035a3.375 3.375 0 0 0 2.456 2.456L21.75 6l-1.035.259a3.375 3.375 0 0 0-2.456 2.456Z" /></svg>
                </button>
              </div>
            </div>
            <div class="flex items-stretch gap-1 mt-2">
              <div class="relative flex-grow">
                <select [(ngModel)]="imageStyle" class="w-full h-full appearance-none text-left p-2 pl-3 pr-8 bg-gray-700 border-gray-600 rounded-l-md text-white text-sm focus:ring-purple-500 focus:border-purple-500">
                  @for(style of imageStyles; track style) { <option [value]="style">{{style}}</option> }
                </select>
                <div class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-2 text-gray-400">
                  <svg class="fill-current h-4 w-4" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20"><path d="M9.293 12.95l.707.707L15.657 8l-1.414-1.414L10 10.828 5.757 6.586 4.343 8z"/></svg>
                </div>
              </div>
              <div class="relative">
                <select [(ngModel)]="aspectRatio" class="w-full h-full appearance-none text-left p-2 pl-3 pr-8 bg-gray-700 border-gray-600 text-white text-sm focus:ring-purple-500 focus:border-purple-500">
                   @for(ratio of aspectRatios; track ratio) { <option [value]="ratio">{{ratio}}</option> }
                </select>
                <div class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-2 text-gray-400">
                  <svg class="fill-current h-4 w-4" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20"><path d="M9.293 12.95l.707.707L15.657 8l-1.414-1.414L10 10.828 5.757 6.586 4.343 8z"/></svg>
                </div>
              </div>
              <button (click)="triggerImageGeneration(imageStyle(), aspectRatio())" [disabled]="!slide().imagePrompt"
                      class="px-3 bg-purple-600 text-white font-semibold rounded-r-md hover:bg-purple-700 disabled:bg-gray-500 disabled:cursor-not-allowed text-sm">
                Generate
              </button>
            </div>
          </div>
        }
      }
    </div>
  </ng-template>
}
@if (isOpen()) {
<div class="fixed bottom-24 right-6 w-96 h-[600px] bg-gray-800/90 backdrop-blur-sm border border-gray-700 rounded-lg shadow-2xl flex flex-col z-40 animate-slide-in-from-right">
    <!-- Header -->
    <header class="flex items-center justify-between p-4 border-b border-gray-700 flex-shrink-0">
        <div class="flex items-center gap-3">
             <div class="w-10 h-10 rounded-full bg-gradient-to-tr from-purple-500 to-pink-500 flex items-center justify-center">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-white" viewBox="0 0 20 20" fill="currentColor"><path d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586zM12 6a2 2 0 100-4 2 2 0 000 4zM10 18a2 2 0 100-4 2 2 0 000 4zM4 10a2 2 0 100-4 2 2 0 000 4z" /></svg>
            </div>
            <h2 class="text-lg font-bold text-white">Super Agent</h2>
        </div>
        <div class="flex items-center gap-4">
          <button (click)="closeChat.emit()" class="text-gray-400 hover:text-white text-2xl">&times;</button>
        </div>
    </header>

    <!-- Message History -->
    <div #chatContainer class="flex-grow p-4 space-y-4 overflow-y-auto">
        @for (message of messages(); track i; let i = $index) {
            <div class="flex items-end gap-2" [class.flex-row-reverse]="message.sender === 'user'" [class.justify-start]="message.sender === 'bot'">
                <div class="max-w-xs md:max-w-sm rounded-lg px-4 py-2" [class.bg-purple-600]="message.sender === 'user'" [class.bg-gray-700]="message.sender === 'bot'" [class.rounded-br-none]="message.sender === 'user'" [class.rounded-bl-none]="message.sender === 'bot'">
                    <p class="text-white text-sm whitespace-pre-wrap">{{ message.text }}
                      @if(message.isStreaming) {
                        <span class="inline-block w-2 h-2 ml-1 bg-white rounded-full animate-pulse"></span>
                      }
                    </p>
                </div>
            </div>
        }
    </div>

    <!-- Input Area -->
    <footer class="p-4 border-t border-gray-700 flex-shrink-0">
        <div class="flex items-center gap-2">
            <input type="text" 
                   [ngModel]="userInput()" 
                   (ngModelChange)="userInput.set($event)"
                   (keydown.enter)="sendMessage()"
                   [placeholder]="'Give me a command...'"
                   class="flex-grow bg-gray-700 border-gray-600 rounded-full shadow-sm p-3 text-white focus:ring-purple-500 focus:border-purple-500 text-sm pl-4">
            <button (click)="sendMessage()" [disabled]="!userInput() || isAgentThinking()" class="bg-purple-600 text-white rounded-full p-3 hover:bg-purple-700 disabled:bg-gray-500 disabled:cursor-not-allowed">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path d="M10.894 2.553a1 1 0 00-1.788 0l-7 14a1 1 0 001.169 1.409l5-1.428A1 1 0 009 15.571V11a1 1 0 112 0v4.571a1 1 0 00.725.962l5 1.428a1 1 0 001.17-1.408l-7-14z" /></svg>
            </button>
        </div>
    </footer>
</div>
}